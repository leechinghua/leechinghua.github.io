<!DOCTYPE html>
<html lang="zh-hant-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      main {
        display: flex;
        /* border: 1px solid #000;*/
      }
      /* controls */
      .controls {
        display: flex;
        align-items: center;
      }

      .icon {
        height: 20px;
        cursor: pointer;
        :hover {
          opacity: 0.5;
        }
      }
      svg {
        width: 100%;
        height: 100%;
        min-width: 10px;
      }

      aside {
        width: 40%;
      }
      aside ul {
        list-style-type: none;
        & li {
          background-color: #dcdcdc;
          padding: 8px;
          margin-bottom: 4px;
          border: 2px solid #7a7a7a;
          cursor: move;
          &.dragging {
            opacity: 0.5;
          }
          .minus {
            width: 20px;
            height: 20px;
            background-color: white;
            height: 100%;
            border: 1px solid #dcdcdc;
            border-radius: 5px;
            margin-right: 5px;
          }
        }
      }

      #plus {
        width: 30px;
        height: 30px;
      }
      input[type="file"] {
        display: none;
      }

      .volume-control {
        display: none; /* 初始隱藏 */
        position: absolute;
        bottom: 50px;
        right: 20px;
        background: #f1f1f1;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
    </style>
    <title>Video</title>
  </head>
  <body>
    <div class="container">
      <main class="row">
        <section class="video col-8">
          <video id="player" width="100%"></video>
          <div class="controls row">
            <div class="icon col-1" id="last">
              <svg><use href="#icon1" /></svg>
            </div>
            <div class="icon col-1" id="play">
              <svg><use href="#icon2" /></svg>
            </div>
            <div class="icon col-1" id="pause">
              <svg><use href="#icon5" /></svg>
            </div>
            <div class="icon col-1" id="next">
              <svg><use href="#icon3" /></svg>
            </div>
            <div class="icon col-7 d-flex">
              <input type="range" class="form-range px-2" />
              <output class=""></output>
            </div>
            <div class="icon col-1" id="voice">
              <svg><use href="#icon4" /></svg>
            </div>
          </div>
          <div class="volume-control" id="volumeControl">
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" />
          </div>
        </section>
        <aside class="col-4">
          <ul class="btns" id="btns">
            <li id="video1" draggable="true">
              <button class="minus">-</button>影片1
            </li>

            <li id="video2" draggable="true">
              <button class="minus">-</button>影片2
            </li>
            <li id="video3" draggable="true">
              <button class="minus">-</button>影片3
            </li>
            <li id="video4" draggable="true">
              <button class="minus">-</button>影片4
            </li>
          </ul>
          <ul>
            <button id="plus">+</button>
            <input type="file" name="myFiles" id="myFiles" accept="video/*" />
          </ul>
        </aside>
      </main>
    </div>
    <svg style="display: none">
      <defs>
        <symbol id="icon1" viewBox="0 0 320 512">
          <path
            d="M267.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4l-192 160L64 241V96c0-17.7-14.3-32-32-32S0 78.3 0 96V416c0 17.7 14.3 32 32 32s32-14.3 32-32V271l11.5 9.6 192 160z"
          />
        </symbol>
        <symbol
          id="icon2"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 384 512"
        >
          <path
            d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"
          />
        </symbol>
        <symbol
          id="icon3"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 320 512"
        >
          <path
            d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z"
          />
        </symbol>
        <symbol
          id="icon4"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 448 512"
        >
          <path
            d="M301.1 34.8C312.6 40 320 51.4 320 64V448c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h67.8L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3zM412.6 181.5C434.1 199.1 448 225.9 448 256s-13.9 56.9-35.4 74.5c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C393.1 284.4 400 271 400 256s-6.9-28.4-17.7-37.3c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5z"
          />
        </symbol>
        <symbol
          id="icon5"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 320 512"
        >
          <path
            d="M48 64C21.5 64 0 85.5 0 112V400c0 26.5 21.5 48 48 48H80c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zm192 0c-26.5 0-48 21.5-48 48V400c0 26.5 21.5 48 48 48h32c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H240z"
          />
        </symbol>
      </defs>
    </svg>
    <script>
      // 側欄點擊播放功能
      const playList = [
        "./videos/video1.mp4",
        "./videos/video2.mp4",
        "./videos/video3.mp4",
        "./videos/video4.mp4",
      ];
      let playNum = 0;
      const player = document.querySelector("#player");
      const btnsDiv = document.querySelector(".btns");
      const btns = {
        v1: document.querySelector("#video1"),
        v2: document.querySelector("#video2"),
        v3: document.querySelector("#video3"),
        v4: document.querySelector("#video4"),
      };

      player.setAttribute(
        "poster",
        "https://images.pexels.com/photos/1323550/pexels-photo-1323550.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"
      );

      btnsDiv.addEventListener("click", (e) => {
        const clickedButton = e.target.closest("li");
        if (clickedButton) {
          const index = Array.from(btnsDiv.children).indexOf(clickedButton);
          if (index !== -1) {
            playNum = index;
            player.src = playList[playNum];
            player.play();
          }
        }
      });
      // controls 功能
      const controlsUl = document.querySelector(".controls");
      const controls = {
        last: document.querySelector("#last"),
        play: document.querySelector("#play"),
        pause: document.querySelector("#pause"),
        next: document.querySelector("#next"),
        voice: document.querySelector("#voice"),
      };
      controlsUl.addEventListener("click", (e) => {
        const action = e.target.closest(".icon");
        console.log(action);
        switch (action) {
          case controls.last:
            if (playNum > 0) {
              playNum--;
              player.src = playList[playNum];
              player.play();
            }
            break;
          case controls.play:
            // if (player.paused) {
            //   player.play();
            //   playChain();
            // }
            if (!player.src) {
              player.src = playList[0];
              player.play();
              playChain();
            } else if (player.paused) {
              player.play();
              playChain();
            }
            break;
          case controls.pause:
            if (!player.paused) {
              player.pause();
            }
            break;
          case controls.next:
            if (playNum < playList.length - 1) {
              playNum++;
              player.src = playList[playNum];
              player.play();
            }
            break;
          case controls.voice:
            toggleVolumeControl();
            break;
        }
      });

      // 顯示/隱藏音量控制
      function toggleVolumeControl() {
        const volumeControl = document.querySelector("#volumeControl");
        volumeControl.style.display =
          volumeControl.style.display === "none" ? "block" : "none";
      }

      // 音量調整功能
      const volumeSlider = document.querySelector("#volumeSlider");
      volumeSlider.addEventListener("input", (e) => {
        player.volume = e.target.value;
      });

      // 影片拖曳與放置功能
      function dragFunction() {
        let draggedItem = null;
        document.querySelectorAll(".btns li").forEach((item) => {
          item.addEventListener("dragstart", (e) => {
            draggedItem = e.target;
            e.target.classList.add("dragging");
          });
          item.addEventListener("dragend", (e) => {
            e.target.classList.remove("dragging");
          });
          item.addEventListener("dragover", (e) => {
            e.preventDefault();
          });
          item.addEventListener("drop", (e) => {
            e.preventDefault();
            const _this = e.target;
            if (_this !== draggedItem) {
              let list = draggedItem.parentNode;
              let draggingIndex = [...list.children].indexOf(draggedItem);
              let dropIndex = [...list.children].indexOf(_this);
              console.log(draggingIndex, dropIndex);

              if (draggingIndex > dropIndex) {
                list.insertBefore(draggedItem, _this);
              } else {
                list.insertBefore(draggedItem, _this.nextSibling);
              }
            }
          });
        });
      }
      dragFunction();
      // 影片上傳功能
      function plusFunction() {
        plus.addEventListener("click", () => {
          myFiles.click();
        });
        myFiles.addEventListener("change", (event) => {
          let fileList = event.target.files;
          [...fileList].forEach((file) => {
            let newLi = document.createElement("li");
            newLi.innerHTML = `<button class="minus">-</button>${file.name}`;
            newLi.setAttribute("draggable", "true");
            btnsDiv.appendChild(newLi);
            let reader = new FileReader();
            reader.addEventListener("load", (e) => {
              playList.push(e.target.result);
              playNum = playList.length - 1;
              player.src = e.target.result;
              console.log(player.src);
              player.play();
            });
            reader.readAsDataURL(file);
            dragFunction();
            clickMinusFunction();
          });
        });
      }

      plusFunction();
      // 影片移除功能
      function minusFunction(event) {
        const li = event.target.closest("li");
        const btns = document.querySelector("#btns");
        const index = Array.from(btns.children).indexOf(li);
        if (index > -1) {
          playList.splice(index, 1);
          li.remove();
          console.log(`Removed video at index ${index}`);
        }
      }
      function clickMinusFunction() {
        document.querySelectorAll(".minus").forEach((button) => {
          button.addEventListener("click", minusFunction);
        });
      }
      clickMinusFunction();
      // 影片進度條功能
      const range = document.querySelector("input[type=range]");
      const output = document.querySelector("output");

      player.addEventListener("loadedmetadata", () => {
        range.max = player.duration;
      });
      player.addEventListener("timeupdate", () => {
        range.value = player.currentTime;
        output.value = formatTime(player.currentTime);
      });

      document
        .querySelector("input[type=range]")
        .addEventListener("input", (e) => {
          document.querySelector("output").value = e.target.value;
        });

      range.addEventListener("input", (e) => {
        player.currentTime = e.target.value;
        output.value = formatTime(e.target.value);
      });

      // 格式化時間為 mm:ss
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secondsLeft = Math.floor(seconds % 60);
        return `${minutes}:${secondsLeft < 10 ? "0" : ""}${secondsLeft}`;
      }

      // 影片連續播放
      function playChain() {
        player.addEventListener("ended", () => {
          playNum++;
          if (playNum >= playList.length) {
            playNum = 0;
          }
          player.src = playList[playNum];
          player.play();
        });
      }
    </script>
  </body>
</html>
